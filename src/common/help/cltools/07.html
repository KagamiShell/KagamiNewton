<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link rel="stylesheet" type="text/css" href="../shared/style.css">
</head>
<body marginwidth="0" marginheight="0">
<table width="100%" height="30" border="0" cellspacing="0" cellpadding="5" bgcolor="#E0E0E0">
<tr><td align="left" valign="middle" class="title">Менеджер "плавающих" лицензий для игр</td></tr></table>
<br>
<div align="justify">
<br>
Менеджер "плавающих" лицензий для игр необходимо использовать для запуска игр, которые требуют лицензирования и когда количество купленных вами лицензий меньше общего числа машин в сети.<br>
Таким образом, в данную игру смогут одновременно играть не более N-машин из общего числа, однако сами эти машины могут быть каждый раз разными и таким образом лицензии будут "перемещаться" от одной машины к другой при запуске.<br>
Если же все лицензии игры "разобраны" разными машинами и свободных в данный момент нет, то при запуске игры пользователю будет выдано соотв. сообщение и запуска игры на его машине не произойдет.<br>
<br>
<b>Принцип работы</b><br>
Для каждой игры, которая требует лицензирования, создается на сервере .ini-файл с лицензиями. Сколько таких игр, столько будет и файлов (исключение для steam-игр, см. ниже).<br>
Далее в настройках ярлыка такой игры необходимо установить путь относительно <b>СЕРВЕРА</b> к соотв. ini-файлу в параметре <b>"Плавающая лицензия"</b>. Путь должен быть доступен с сервера, т.к. именно сервер (а не клиент!) будет считывать файл. Если программа администратора также находится на сервере, то файл можно выбрать через окошко обзора файлов, а иначе - вписать путь вручную.<br>
При запуске игры произойдет передача на сервер запроса, а сервер, в свою очередь, опросит все машины на предмет запуска в данный момент времени конкретной игры, и, если имеется свободная лицензия, то она будет возвращена на клиентскую машину ввиде переменной окружения <b>%FLOATLIC%</b>, после чего происходит запуск игры.<br>
Использовать данную переменную окружения можно по-разному, т.к. все зависит от конкретной игры и как именно в этой игре организовано лицензирование.
Например, для некоторых игр достаточно передать логин/пароль в командную строку, для других - записать лицензию в реестр или определенный файл.
Таким образом, строка <b>%FLOATLIC%</b> может представлять разные значения.<br>
<br>
<b>Формат ini-файла</b><br>
Для каждой такой игры должен быть создан на сервере свой <b>отдельный</b> файл.<br>
Все данные находятся в одной секции <b>[Main]</b>:<br>
<br>
<pre>
;-----------------------
<b>[Main]</b>
<b>Name=</b>название_игры
<b>Exe=</b>[exe_file1[,exe_file2[,...]]]
<b>Steam=</b>[1 или 0]
<b>Server=</b>[сервер[:порт]]
<b>Keep=</b>[время_в_сек]
<b>ExeDelayLoad=</b>[время_в_сек]
<b>DoNotAsk=</b>[1 или 0]
<b>Lic0=</b>лицензия_1
<b>Lic1=</b>лицензия_2
<b>Lic2=</b>лицензия_3
....
<b>LicN=</b>лицензия_N+1
;-----------------------
</pre>
<br>
Параметр <b>Name</b> определяет название игры. Он должен быть указан обязательно и для каждой игры быть своим уникальным.<br>
<br>
Параметр <b>Exe</b> является необязательным и его нужно указывать только для тех игр, которые запускаются через постоянно запущенную программу (например, для Steam). В случае со Steam'ом базовый файл steam.exe остается всегда запущен в системе, а различные игры запускаются через него, потому отследить, запущена ли игра в данный момент или нет, однозначно нельзя. В таких случаях необходимо в параметре <b>Exe</b> указать один или несколько exe-файлов игры. Если хотя бы один из этих файлов работает в данный момент, то считается, что и игра запущена. Можно указывать только имена файлов без пути, а можно и с полным путем (также допускается использование переменных окружения %переменная% и масок "*", "?").<br>
Примеры:<br>
Exe=game.exe<br>
Exe=%ProgramFiles%\game\game.exe<br>
Exe=%ProgramFiles%\game\game_e1.exe,%ProgramFiles%\game\game_e2.exe<br>
<br>
<b>LicN</b> (где N от 0 до 999) определяет N-ую купленную вами лицензию для данной игры. Если у вас куплено 10 лицензий, то должно быть 10 строк от Lic0 до Lic9<br>
Сама строка лицензии может представлять что угодно в зависимости от самой игры (общего подхода здесь нет).<br>
<br>
Параметр <b>Steam</b> нужно использовать только для пакетных Steam-игр (указать <b>Steam=1</b>).<br>
Если у вас куплено N-лицензий Steam, а из пакета Steam пользователи могут запускать множество игр, то при таком сценарии
необходимо создать лишь один файл на сервере (например, steam.ini) и установить его как плавающую лицензию
для всех ярлыков Steam-игр. Суть параметра <b>Steam=1</b> заключается в том, чтобы закрывать автоматически Steam-сессию на той клиентской машине, которая в данный момент не использует Steam-игру, но "держит" лицензию. Шелл будет автоматически закрывать такую сессию при необходимости ее освобождения.<br>
Также необходимо обязательно перечислить в параметре <b>Exe=</b> все игры, которые у вас запускаются через стим (полные пути или только имена exe-файлов игр через запятую).<br>
Каждая Steam-игра должна запускаться так:<br>
Файл запуска ярлыка: <b>%ProgramFiles%\Steam\Steam.exe</b><br>
Аргументы командной строки: <b>-login %FLOATLIC% -language russian -applaunch &lt;id&gt; [аргументы_для_игры]</b><br>
В аргумент <b>%FLOATLIC%</b> будет передаваться купленный логин/пароль (через пробел) из параметров LicX вашего файла steam.ini;<br>
Аргумент <b>id</b> обозначает идентификатор Steam-игры;<br>
<b>аргументы_для_игры</b> - необязательные параметры, которые будут передаваться в саму игру.<br>
Пример для Steam-пакета см. ниже.<br>
<br>
Параметр <b>Server</b> нужно использовать только в том случае, если у вас есть модуль плавающих лицензий для сети клубов (приобретается отдельно), он служит для распределения лицензий между клубами и должен быть установлен на одном глобальном сервере, к которому <b>каждая клиентская машина любого клуба</b> могла бы иметь доступ (через TCP-протокол).<br>
Если необходимо распределять ограниченное число лицензий между клубами, то .ini-файл плавающей лицензии для какой-либо игры должен быть одинаковым на всех локальных серверах клубов, или можно его держать в одном экземпляре на глобальном сервере, но в этом случае сервера клубов должны иметь доступ через сеть к этому файлу (в ярлыках тогда указывать \\global_server\...\file.ini). Напомним, что чтение .ini-файла ведет локальный сервер клуба, а не клиентская машина! В качестве параметра <b>Server</b> необходимо указать IP или DNS-имя глобального сервера и опционально порт связи. Если порт не указать, то будет использоваться стандартный <b>HTTP 80</b>.<br>
Если связи с глобальным сервером нет по какой-то причине, то менеджер переходит в режим работы без сервера (так, как будто бы сервер не указан в параметре <b>Server</b>) в пределах одного клуба.<br>
<br>
Параметр <b>Keep</b> нужно использовать для резервирования выбранной лицензии на N-секунд после первого старта. Например, пользователь получил лицензию номер 2 и после обновления игры ему нужно произвести перезагрузку машины, а затем далее продолжить с этой же лицензией и быть уверенным, что ее не "захватит" кто-то другой за время его перезагрузки. В этом случае можно указать время в секундах, в течение которого лицензия будет занята под этого пользователя. Если указать время меньшее 60 сек, то будет считаться что указано 60 сек.<br>
<b>Внимание!</b> Данный параметр лучше использовать только если используется глобальный сервер (установлен параметр <b>Server</b>).<br>
<br>
Параметр <b>ExeDelayLoad</b> обычно используют совместно со steam и служит для случаев когда игра может запуститься позже на N-секунд после старта steam (например, несколько минут может уйти на его обновление и лишь потом запустится игра), в этом случае в течение N-секунд после старта лицензия не будет освобождена несмотря на то, что сам exe-файл игры может быть еще не запущен.<br>
<br>

Параметр <b>DoNotAsk</b> можно установить в <b>1</b> чтобы не выдавать запрос на выбор свободной лицензии из списка (в этом случае она будет выбираться автоматически).<br>
<br>
<b>Внимание!</b> Механизм плавающих лицензий имеет свою инерционность. Т.е., если пользователь закрыл лицензированное приложение, то лицензия может освободиться не сразу, а с интервалом <b>от 1 до 60 сек</b>!<br>
<br>

<br>
Далее на вымышленных примерах можно рассмотреть возможные варианты использования строк лицензий.<br>
<br>
<font color=red><b>Пример 1.</b></font><br>
Лицензии для игры передаются ввиде параметров командной строки: -login XXX -password YYY<br>
<pre>
;-----------------------
<b>[Main]</b>
<b>Name=</b>Игра 1
<b>Lic0=</b>-login 7658675 -password 219356
<b>Lic1=</b>-login 2341799 -password 128702
;-----------------------
</pre>
В аргументах командной строки ярлыка игры достаточно просто указать:<br>
<b>%FLOATLIC%</b><br>
<br>
<font color=red><b>Пример 2.</b></font><br>
Лицензия для игры должна храниться в файле lic.dat в папке игры. Купленные файлы хранятся на сервере в папке \\server\game2\lic<br>
<pre>
;-----------------------
<b>[Main]</b>
<b>Name=</b>Игра 2
<b>Lic0=</b>lic1.dat
<b>Lic1=</b>lic2.dat
;-----------------------
</pre>
В скрипте до старта программы необходимо указать:<br>
copy /Y \\server\game2\lic\<b>%FLOATLIC%</b> c:\game2\lic.dat<br>
<br>
<font color=red><b>Пример 3.</b></font><br>
Лицензия для игры должна храниться в реестре. А на сервере лежат подготовленные .reg-файлы<br>
<pre>
;-----------------------
<b>[Main]</b>
<b>Name=</b>Игра 3
<b>Lic0=</b>lic1.reg
<b>Lic1=</b>lic2.reg
;-----------------------
</pre>
В скрипте до старта программы необходимо указать:<br>
reg IMPORT \\server\game3\lic\<b>%FLOATLIC%</b><br>
<b>(при этом необходимо не забыть убрать запрет на редактирование реестра в настройках "Безопасность: Система")</b><br>
<br>
<font color=red><b>Пример 4.</b></font><br>
Установку лицензии для игры делает ваш скрипт или программа, нужно ее запустить с командной строкой.<br>
<pre>
;-----------------------
<b>[Main]</b>
<b>Name=</b>Игра 4
<b>Lic0=</b>987693475
<b>Lic1=</b>127629782
;-----------------------
</pre>
В скрипте до старта программы необходимо указать ваш скрипт/программу:<br>
start /WAIT c:\myprog.exe <b>%FLOATLIC%</b><br>
<br>
<font color=red><b>Пример 5.</b></font><br>
Необходимо просто ограничить одновременный запуск игры/программы не более чем в N-экземплярах в сети, а самих лицензий как таковых нет.<br>
<pre>
;-----------------------
<b>[Main]</b>
<b>Name=</b>Игра 5
<b>Lic0=</b>1
<b>Lic1=</b>1
...
<b>LicN=</b>1
;-----------------------
</pre>
В этом случае нельзя будет запустить более N+1 копий игры в сети.<br>
<br>
<font color=red><b>Пример 6.</b></font><br>
<b>Steam</b>-пакет (этот один файл устанавливается для всех Steam-игр):<br>
<pre>
;-----------------------
<b>[Main]</b>
<b>Name=</b>Steam
<b>Steam=</b>1
<b>Exe=</b>quake3.exe,quake.exe,hl.exe,doom3.exe
<b>Lic0=</b>login1 password1
<b>Lic1=</b>login2 password2
...
<b>LicN=</b>loginN passwordN
;-----------------------
</pre>
См. выше более подробное описание параметра <b>Steam</b><br>
<br>

<br>
Также примеры могут быть и более сложными.<br>
<br>

<br>
<br>
</div>
</body>
</html>
